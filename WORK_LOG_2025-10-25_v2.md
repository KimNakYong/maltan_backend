# ì‘ì—… ì¼ì§€ - 2025ë…„ 10ì›” 25ì¼ (v3)

## ğŸ“‹ ì‘ì—… ê°œìš”
1. ì»¤ë®¤ë‹ˆí‹° ì„œë¹„ìŠ¤ì˜ ì¸ì¦ ì‹œìŠ¤í…œ ì„ì‹œ êµ¬í˜„ ë° ì¸ê¸° ê²Œì‹œê¸€ ê¸°ëŠ¥ ì¶”ê°€
2. ê´€ë¦¬ì í˜ì´ì§€ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ êµ¬í˜„
3. User Serviceì™€ Community Service ê°„ ì—°ë™ (ì‚¬ìš©ì ì´ë¦„ ì¡°íšŒ)
4. ê²Œì‹œê¸€/ëŒ“ê¸€ ì‘ì„± í›„ ì‘ë‹µ ì²˜ë¦¬ ìˆ˜ì •

---

## ğŸ”§ User Service

### 1. ê´€ë¦¬ì í˜ì´ì§€ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§ API ì¶”ê°€

#### ì‹ ê·œ íŒŒì¼

**1) SystemMetrics.java (DTO)**
```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class SystemMetrics {
    private Double cpuUsage;      // CPU ì‚¬ìš©ë¥  (%)
    private Double memoryUsage;   // ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  (%)
    private Double diskUsage;     // ë””ìŠ¤í¬ ì‚¬ìš©ë¥  (%)
    private Long totalMemory;     // ì „ì²´ ë©”ëª¨ë¦¬ (bytes)
    private Long usedMemory;      // ì‚¬ìš© ì¤‘ì¸ ë©”ëª¨ë¦¬ (bytes)
    private Long freeMemory;      // ì—¬ìœ  ë©”ëª¨ë¦¬ (bytes)
}
```

**2) SystemMetricsService.java**
```java
@Service
public class SystemMetricsService {
    
    public SystemMetrics getSystemMetrics() {
        OperatingSystemMXBean osBean = ManagementFactory.getOperatingSystemMXBean();
        Runtime runtime = Runtime.getRuntime();
        
        // CPU ì‚¬ìš©ë¥ 
        double cpuUsage = osBean.getSystemLoadAverage() / osBean.getAvailableProcessors() * 100;
        
        // ë©”ëª¨ë¦¬ ì •ë³´
        long totalMemory = runtime.totalMemory();
        long freeMemory = runtime.freeMemory();
        long usedMemory = totalMemory - freeMemory;
        double memoryUsage = (double) usedMemory / totalMemory * 100;
        
        // ë””ìŠ¤í¬ ì‚¬ìš©ë¥ 
        File root = new File("/");
        long totalSpace = root.getTotalSpace();
        long freeSpace = root.getFreeSpace();
        double diskUsage = (double) (totalSpace - freeSpace) / totalSpace * 100;
        
        return SystemMetrics.builder()
            .cpuUsage(Math.max(0, Math.min(100, cpuUsage)))
            .memoryUsage(memoryUsage)
            .diskUsage(diskUsage)
            .totalMemory(totalMemory)
            .usedMemory(usedMemory)
            .freeMemory(freeMemory)
            .build();
    }
}
```

**3) AdminUserController.java - ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€**
```java
@GetMapping("/system/metrics")
public ResponseEntity<SystemMetrics> getSystemMetrics() {
    SystemMetrics metrics = systemMetricsService.getSystemMetrics();
    return ResponseEntity.ok(metrics);
}
```

---

### 2. Internal API ì¶”ê°€ (ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©ì ì´ë¦„ ì¡°íšŒ)

#### ì‹ ê·œ íŒŒì¼

**InternalUserController.java**
```java
@RestController
@RequestMapping("/user/internal")  // context-pathê°€ /apiì´ë¯€ë¡œ ì‹¤ì œ ê²½ë¡œëŠ” /api/user/internal
@RequiredArgsConstructor
public class InternalUserController {
    
    private final UserRepository userRepository;
    
    /**
     * ì‚¬ìš©ì IDë¡œ ì´ë¦„ ì¡°íšŒ
     */
    @GetMapping("/users/{userId}/name")
    public ResponseEntity<Map<String, String>> getUserName(@PathVariable Long userId) {
        User user = userRepository.findById(userId)
            .orElseThrow(() -> new RuntimeException("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + userId));
        
        Map<String, String> response = new HashMap<>();
        response.put("userId", String.valueOf(userId));
        response.put("name", user.getName());
        
        return ResponseEntity.ok(response);
    }
}
```

#### ì£¼ì˜ì‚¬í•­
- User Serviceì˜ `context-path`ê°€ `/api`ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ
- `@RequestMapping("/user/internal")`ë¡œ ì„¤ì •í•˜ë©´ ì‹¤ì œ ê²½ë¡œëŠ” `/api/user/internal`ì´ ë¨
- Community Serviceì—ì„œ í˜¸ì¶œ ì‹œ `http://10.0.2.15:8081/api/user/internal/users/{userId}/name` ì‚¬ìš©

---

## ğŸ’¬ Community Service

### 1. ì„ì‹œ ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ (userId ì „ë‹¬)

#### ë¬¸ì œì 
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ API í˜¸ì¶œ ì‹œ `@RequestAttribute("userId")`ê°€ ì—†ì–´ 500 ì—ëŸ¬ ë°œìƒ
- ê²Œì´íŠ¸ì›¨ì´/ì¸ì¦ í•„í„°ê°€ ì™„ì „íˆ êµ¬í˜„ë˜ì§€ ì•Šì•„ userIdê°€ ì „ë‹¬ë˜ì§€ ì•ŠìŒ

#### í•´ê²° ë°©ë²•
ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ `@RequestAttribute`ë¥¼ ì„ íƒì‚¬í•­ìœ¼ë¡œ ë³€ê²½í•˜ê³ , ì„ì‹œë¡œ ìš”ì²­ ë³¸ë¬¸/ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ userIdë¥¼ ë°›ë„ë¡ ìˆ˜ì •

#### ìˆ˜ì •ëœ íŒŒì¼

**1) CreatePostRequest.java**
```java
// ì„ì‹œ: ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì „ê¹Œì§€ ìš”ì²­ ë³¸ë¬¸ì—ì„œ ë°›ìŒ
private Long userId;
```

**2) PostController.java**
```java
@PostMapping
public ResponseEntity<PostResponse> createPost(
        @Valid @RequestBody CreatePostRequest request,
        @RequestAttribute(value = "userId", required = false) Long userIdFromAttribute
) {
    // ì„ì‹œ: ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì „ê¹Œì§€ ìš”ì²­ ë³¸ë¬¸ì—ì„œ userId ì‚¬ìš©
    Long userId = userIdFromAttribute != null ? userIdFromAttribute : request.getUserId();
    if (userId == null) {
        throw new IllegalArgumentException("userIdëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
    }
    PostDto post = postService.createPost(request, userId);
    return ResponseEntity.status(HttpStatus.CREATED)
        .body(PostResponse.builder().post(post).build());
}
```

**3) CreateCommentRequest.java**
```java
// ì„ì‹œ: ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì „ê¹Œì§€ ìš”ì²­ ë³¸ë¬¸ì—ì„œ ë°›ìŒ
private Long userId;
```

**4) CommentController.java**
```java
@PostMapping("/posts/{postId}/comments")
public ResponseEntity<CommentDto> createComment(
        @PathVariable Long postId,
        @Valid @RequestBody CreateCommentRequest request,
        @RequestAttribute(value = "userId", required = false) Long userIdFromAttribute
) {
    Long userId = userIdFromAttribute != null ? userIdFromAttribute : request.getUserId();
    if (userId == null) {
        throw new IllegalArgumentException("userIdëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
    }
    CommentDto comment = commentService.createComment(postId, request, userId);
    return ResponseEntity.status(HttpStatus.CREATED).body(comment);
}
```

**5) VoteRequest.java**
```java
// ì„ì‹œ: ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì „ê¹Œì§€ ìš”ì²­ ë³¸ë¬¸ì—ì„œ ë°›ìŒ
private Long userId;
```

**6) VoteController.java**
```java
// ê²Œì‹œê¸€ íˆ¬í‘œ
@PostMapping("/posts/{postId}/vote")
public ResponseEntity<VoteResponse> votePost(
        @PathVariable Long postId,
        @Valid @RequestBody VoteRequest request,
        @RequestAttribute(value = "userId", required = false) Long userIdFromAttribute
) {
    Long userId = userIdFromAttribute != null ? userIdFromAttribute : request.getUserId();
    if (userId == null) {
        throw new IllegalArgumentException("userIdëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
    }
    VoteResponse response = voteService.votePost(postId, request, userId);
    return ResponseEntity.ok(response);
}

// ê²Œì‹œê¸€ íˆ¬í‘œ ì·¨ì†Œ
@DeleteMapping("/posts/{postId}/vote")
public ResponseEntity<VoteResponse> cancelPostVote(
        @PathVariable Long postId,
        @RequestAttribute(value = "userId", required = false) Long userIdFromAttribute,
        @RequestParam(required = false) Long userId
) {
    Long finalUserId = userIdFromAttribute != null ? userIdFromAttribute : userId;
    if (finalUserId == null) {
        throw new IllegalArgumentException("userIdëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
    }
    VoteResponse response = voteService.cancelPostVote(postId, finalUserId);
    return ResponseEntity.ok(response);
}

// ëŒ“ê¸€ íˆ¬í‘œë„ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ ìˆ˜ì •
```

**7) RecruitmentController.java**
```java
@PostMapping("/{postId}/participate")
public ResponseEntity<ParticipateResponse> toggleParticipation(
        @PathVariable Long postId,
        @RequestAttribute(value = "userId", required = false) Long userIdFromAttribute,
        @RequestParam(required = false) Long userId
) {
    Long finalUserId = userIdFromAttribute != null ? userIdFromAttribute : userId;
    if (finalUserId == null) {
        throw new IllegalArgumentException("userIdëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.");
    }
    ParticipateResponse response = recruitmentService.toggleParticipation(postId, finalUserId);
    return ResponseEntity.ok(response);
}
```

---

### 2. ì¸ê¸° ê²Œì‹œê¸€ ê¸°ëŠ¥ ì¶”ê°€

#### ê¸°ëŠ¥ ì„¤ëª…
- ë§¤ì¼ ìì •ì— ì§€ë‚œ 24ì‹œê°„ ë™ì•ˆ ê°€ì¥ ë§ì€ ì¶”ì²œì„ ë°›ì€ ê²Œì‹œê¸€ì„ ì„ ì •
- ì„ ì •ëœ ê²Œì‹œê¸€ì€ 24ì‹œê°„ ë™ì•ˆ ëª©ë¡ ìµœìƒë‹¨ì— ê³ ì •
- ìµœì†Œ 10ê°œ ì´ìƒì˜ ì¶”ì²œì„ ë°›ì•„ì•¼ ì¸ê¸° ê²Œì‹œê¸€ë¡œ ì„ ì •

#### ìˆ˜ì •/ì¶”ê°€ëœ íŒŒì¼

**1) Post.java (ì—”í‹°í‹°)**
```java
// ì¸ê¸° ê²Œì‹œê¸€ (ìƒë‹¨ ê³ ì •)
@Column(name = "is_pinned")
@Builder.Default
private Boolean isPinned = false;

@Column(name = "pinned_until")
private LocalDateTime pinnedUntil;

// ë¹„ì¦ˆë‹ˆìŠ¤ ë©”ì„œë“œ
public void pin(LocalDateTime until) {
    this.isPinned = true;
    this.pinnedUntil = until;
}

public void unpin() {
    this.isPinned = false;
    this.pinnedUntil = null;
}

public boolean isPinnedAndValid() {
    return this.isPinned && 
           this.pinnedUntil != null && 
           LocalDateTime.now().isBefore(this.pinnedUntil);
}
```

**2) PostDto.java**
```java
// ì¸ê¸° ê²Œì‹œê¸€
private Boolean isPinned;
private LocalDateTime pinnedUntil;
```

**3) PostService.java**
```java
// convertToDto ë©”ì„œë“œì— ì¶”ê°€
.isPinned(post.getIsPinned())
.pinnedUntil(post.getPinnedUntil())
```

**4) PostRepository.java**
```java
// íŠ¹ì • ê¸°ê°„ ì´í›„ ê°€ì¥ ë§ì€ ì¶”ì²œì„ ë°›ì€ ê²Œì‹œê¸€ ì¡°íšŒ
@Query("SELECT p FROM Post p WHERE p.isDeleted = false " +
       "AND p.createdAt >= :since " +
       "ORDER BY p.likeCount DESC, p.viewCount DESC")
List<Post> findTopByLikeCountSince(@Param("since") LocalDateTime since, int limit);

// ê³ ì • ê¸°ê°„ì´ ë§Œë£Œëœ ê²Œì‹œê¸€ ì¡°íšŒ
List<Post> findByIsPinnedTrueAndPinnedUntilBefore(LocalDateTime now);

// ë³µí•© ê²€ìƒ‰ ì¿¼ë¦¬ ìˆ˜ì • - ì¸ê¸° ê²Œì‹œê¸€ ìš°ì„  ì •ë ¬
@Query("SELECT p FROM Post p WHERE p.isDeleted = false " +
       "AND (:category IS NULL OR p.category = :category) " +
       "AND (:regionSi IS NULL OR p.regionSi = :regionSi) " +
       "AND (:regionGu IS NULL OR p.regionGu = :regionGu) " +
       "AND (:regionDong IS NULL OR p.regionDong = :regionDong) " +
       "AND (:isRecruitment IS NULL OR p.isRecruitment = :isRecruitment) " +
       "ORDER BY " +
       "CASE WHEN p.isPinned = true AND p.pinnedUntil > CURRENT_TIMESTAMP THEN 0 ELSE 1 END, " +
       "p.createdAt DESC")
Page<Post> findByFilters(...);
```

**5) PopularPostScheduler.java (ì‹ ê·œ íŒŒì¼)**
```java
@Component
public class PopularPostScheduler {
    
    /**
     * ë§¤ì¼ ìì •ì— ì¸ê¸° ê²Œì‹œê¸€ ì„ ì • ë° ê³ ì •
     */
    @Scheduled(cron = "0 0 0 * * *")
    @Transactional
    public void updatePopularPost() {
        // ê¸°ì¡´ ê³ ì • ê²Œì‹œê¸€ í•´ì œ
        unpinExpiredPosts();
        
        // ì§€ë‚œ 24ì‹œê°„ ë™ì•ˆ ê°€ì¥ ë§ì€ ì¶”ì²œì„ ë°›ì€ ê²Œì‹œê¸€ ì°¾ê¸°
        LocalDateTime yesterday = LocalDateTime.now().minusDays(1);
        List<Post> topPosts = postRepository.findTopByLikeCountSince(yesterday, 1);
        
        if (!topPosts.isEmpty()) {
            Post topPost = topPosts.get(0);
            
            // ìµœì†Œ ì¶”ì²œ ìˆ˜ ì¡°ê±´ (10ê°œ ì´ìƒ)
            if (topPost.getLikeCount() >= 10) {
                // 24ì‹œê°„ ë™ì•ˆ ê³ ì •
                LocalDateTime pinnedUntil = LocalDateTime.now().plusDays(1);
                topPost.pin(pinnedUntil);
                postRepository.save(topPost);
                
                log.info("ì¸ê¸° ê²Œì‹œê¸€ ì„ ì • ì™„ë£Œ: postId={}, likeCount={}", 
                    topPost.getId(), topPost.getLikeCount());
            }
        }
    }
    
    /**
     * ë§¤ ì‹œê°„ë§ˆë‹¤ ë§Œë£Œëœ ê³ ì • ê²Œì‹œê¸€ í•´ì œ
     */
    @Scheduled(cron = "0 0 * * * *")
    @Transactional
    public void unpinExpiredPosts() {
        LocalDateTime now = LocalDateTime.now();
        List<Post> expiredPosts = postRepository.findByIsPinnedTrueAndPinnedUntilBefore(now);
        
        for (Post post : expiredPosts) {
            post.unpin();
            postRepository.save(post);
            log.info("ê³ ì • í•´ì œ: postId={}", post.getId());
        }
    }
}
```

---

### 3. User Service ì—°ë™ (ì‚¬ìš©ì ì´ë¦„ ì¡°íšŒ)

#### ë¬¸ì œì 
- ê¸°ì¡´ì—ëŠ” ê²Œì‹œê¸€/ëŒ“ê¸€ì— ì‚¬ìš©ì ì´ë¦„ì„ ì €ì¥í•˜ì§€ ì•Šì•„ "ì‚¬ìš©ì1", "ì‚¬ìš©ì2" ë“±ìœ¼ë¡œ í‘œì‹œë¨
- DBì— ì¤‘ë³µ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²ƒë³´ë‹¤ User Serviceë¥¼ ì°¸ì¡°í•˜ëŠ” ê²ƒì´ ë°ì´í„° ì¼ê´€ì„± ìœ ì§€ì— ìœ ë¦¬

#### í•´ê²° ë°©ë²•
Community Serviceì—ì„œ ê²Œì‹œê¸€/ëŒ“ê¸€ ì¡°íšŒ ì‹œ User Service APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‚¬ìš©ì ì´ë¦„ì„ ê°€ì ¸ì˜´

#### ì‹ ê·œ íŒŒì¼

**1) UserServiceClient.java**
```java
@Slf4j
@Component
@RequiredArgsConstructor
public class UserServiceClient {
    
    private final RestTemplate restTemplate;
    
    @Value("${user.service.url:http://localhost:8081}")
    private String userServiceUrl;
    
    /**
     * User Serviceì—ì„œ ì‚¬ìš©ì ì´ë¦„ ì¡°íšŒ
     */
    public String getUserName(Long userId) {
        try {
            String url = userServiceUrl + "/api/user/internal/users/" + userId + "/name";
            Map<String, Object> response = restTemplate.getForObject(url, Map.class);
            
            if (response != null && response.containsKey("name")) {
                return (String) response.get("name");
            }
            
            log.warn("User Serviceì—ì„œ ì‚¬ìš©ì ì´ë¦„ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: userId={}", userId);
            return "ì‚¬ìš©ì" + userId;
        } catch (Exception e) {
            log.error("User Service í˜¸ì¶œ ì‹¤íŒ¨: userId={}", userId, e);
            return "ì‚¬ìš©ì" + userId;
        }
    }
}
```

**2) RestTemplateConfig.java**
```java
@Configuration
public class RestTemplateConfig {
    
    @Bean
    public RestTemplate restTemplate() {
        return new RestTemplate();
    }
}
```

#### ìˆ˜ì •ëœ íŒŒì¼

**1) PostService.java**
```java
@RequiredArgsConstructor
public class PostService {
    // ...
    private final UserServiceClient userServiceClient;
    
    private PostDto convertToDto(Post post, Long currentUserId) {
        // ...
        
        // User Serviceì—ì„œ ì‚¬ìš©ì ì´ë¦„ ì¡°íšŒ (ê¸°ì¡´ ì„ì‹œê°’ ì œê±°)
        String userName = userServiceClient.getUserName(post.getUserId());
        
        return PostDto.builder()
            .userId(post.getUserId())
            .userName(userName)  // ì‹¤ì œ ì‚¬ìš©ì ì´ë¦„
            // ...
            .build();
    }
}
```

**2) CommentService.java**
```java
@RequiredArgsConstructor
public class CommentService {
    // ...
    private final UserServiceClient userServiceClient;
    
    private CommentDto convertToDto(Comment comment, Long currentUserId) {
        // ...
        
        // User Serviceì—ì„œ ì‚¬ìš©ì ì´ë¦„ ì¡°íšŒ
        String userName = userServiceClient.getUserName(comment.getUserId());
        
        return CommentDto.builder()
            .userId(comment.getUserId())
            .userName(userName)  // ì‹¤ì œ ì‚¬ìš©ì ì´ë¦„
            .userNickname(userName)  // í˜¸í™˜ì„±ì„ ìœ„í•´ ë™ì¼í•œ ê°’ ì„¤ì •
            // ...
            .build();
    }
}
```

**3) application.yml**
```yaml
# User Service Configuration
user:
  service:
    url: ${USER_SERVICE_URL:http://localhost:8081}
```

**4) deploy-community.yml (GitHub Actions)**
```yaml
- name: Run New Container
  run: |
    docker run -d \
      --name community-service \
      # ... ê¸°ì¡´ í™˜ê²½ ë³€ìˆ˜ë“¤
      -e USER_SERVICE_URL=http://10.0.2.15:8081 \
      community-service:latest
```

#### ì¥ì 
- âœ… DBì— ì¤‘ë³µ ë°ì´í„° ì €ì¥ ì•ˆ í•¨
- âœ… User Serviceì—ì„œ ì´ë¦„ì´ ë³€ê²½ë˜ë©´ ìë™ìœ¼ë¡œ ë°˜ì˜
- âœ… ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ ë°ì´í„° ì¼ê´€ì„± ìœ ì§€

---

## ğŸ¨ Frontend

### 1. ì»¤ë®¤ë‹ˆí‹° API í˜¸ì¶œ ì‹œ userId ì „ë‹¬

#### ìˆ˜ì •ëœ íŒŒì¼

**1) communityService.ts**
```typescript
// CreatePostRequest ì¸í„°í˜ì´ìŠ¤
export interface CreatePostRequest {
  // ... ê¸°ì¡´ í•„ë“œë“¤
  userId?: number;  // ì„ì‹œ: ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì „ê¹Œì§€ í•„ìš”
}

// CreateCommentRequest ì¸í„°í˜ì´ìŠ¤
export interface CreateCommentRequest {
  content: string;
  parentCommentId?: number;
  userId?: number;  // ì„ì‹œ: ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì „ê¹Œì§€ í•„ìš”
}

// íˆ¬í‘œ í•¨ìˆ˜ë“¤
export const votePost = async (postId: number, voteType: 'LIKE' | 'DISLIKE', userId?: number): Promise<void> => {
  await api.post(`/api/community/posts/${postId}/vote`, { voteType, userId });
};

export const unvotePost = async (postId: number, userId?: number): Promise<void> => {
  await api.delete(`/api/community/posts/${postId}/vote${userId ? `?userId=${userId}` : ''}`);
};

export const voteComment = async (commentId: number, voteType: 'LIKE' | 'DISLIKE', userId?: number): Promise<void> => {
  await api.post(`/api/community/comments/${commentId}/vote`, { voteType, userId });
};

export const unvoteComment = async (commentId: number, userId?: number): Promise<void> => {
  await api.delete(`/api/community/comments/${commentId}/vote${userId ? `?userId=${userId}` : ''}`);
};

// ëª¨ì§‘ ì°¸ì—¬
export const toggleParticipation = async (postId: number, userId?: number): Promise<{ participated: boolean; currentCount: number }> => {
  const response = await api.post(`/api/community/posts/${postId}/participate${userId ? `?userId=${userId}` : ''}`);
  return response.data;
};

// Post ì¸í„°í˜ì´ìŠ¤ì— ì¸ê¸° ê²Œì‹œê¸€ í•„ë“œ ì¶”ê°€
export interface Post {
  // ... ê¸°ì¡´ í•„ë“œë“¤
  isPinned?: boolean;  // ì¸ê¸° ê²Œì‹œê¸€ ì—¬ë¶€
  pinnedUntil?: string;  // ê³ ì • ë§Œë£Œ ì‹œê°„
}
```

**2) CommunityWritePage.tsx**
```typescript
import { useAppSelector } from '../store/hooks';

const CommunityWritePage: React.FC = () => {
  const { user } = useAppSelector((state) => state.auth);
  
  const handleSubmit = async () => {
    // ... ê¸°ì¡´ ì½”ë“œ
    
    // userId ì¶”ê°€ (ì„ì‹œ: ì¸ì¦ ì‹œìŠ¤í…œ êµ¬í˜„ ì „ê¹Œì§€)
    if (user?.id) {
      request.userId = parseInt(user.id);
    }
    
    const post = await createPost(request);
    navigate(`/community/${post.id}`);
  };
};
```

**3) CommunityDetailPage.tsx**
```typescript
// íˆ¬í‘œ ì²˜ë¦¬
const handleVote = async (voteType: 'LIKE' | 'DISLIKE') => {
  if (!id || !user?.id) return;
  const userId = parseInt(user.id);
  
  try {
    if (myVote === voteType) {
      await unvotePost(parseInt(id), userId);
    } else {
      await votePost(parseInt(id), voteType, userId);
    }
    // ... ìƒíƒœ ì—…ë°ì´íŠ¸
  } catch (err: any) {
    alert(err.response?.data?.message || 'ì¶”ì²œ/ë¹„ì¶”ì²œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
};

// ëª¨ì§‘ ì°¸ì—¬ ì²˜ë¦¬
const handleParticipate = async () => {
  if (!id || !user?.id) return;
  const userId = parseInt(user.id);
  
  try {
    const result = await toggleParticipation(parseInt(id), userId);
    setParticipated(result.participated);
    // ... ìƒíƒœ ì—…ë°ì´íŠ¸
  } catch (err: any) {
    alert(err.response?.data?.message || 'ì°¸ì—¬ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
};

// ëŒ“ê¸€ ì‘ì„± ì²˜ë¦¬
const handleSubmitComment = async () => {
  await createComment(parseInt(id), {
    content: newComment,
    parentCommentId: replyTo || undefined,
    userId: user?.id ? parseInt(user.id) : undefined,
  });
};
```

---

### 2. ì¸ê¸° ê²Œì‹œê¸€ ì‹œê°ì  í‘œì‹œ

**CommunityPage.tsx**
```typescript
import { Whatshot } from '@mui/icons-material';

// ê²Œì‹œê¸€ ì¹´ë“œì— ì¸ê¸° ì•„ì´ì½˜ ì¶”ê°€
<Box sx={{ display: 'flex', gap: 1, mb: 1, flexWrap: 'wrap', alignItems: 'center' }}>
  {post.isPinned && post.pinnedUntil && new Date(post.pinnedUntil) > new Date() && (
    <Chip
      label="ì¸ê¸°"
      size="small"
      color="error"
      icon={<Whatshot />}
      sx={{
        fontWeight: 'bold',
        animation: 'pulse 2s ease-in-out infinite',
        '@keyframes pulse': {
          '0%, 100%': { opacity: 1 },
          '50%': { opacity: 0.7 },
        },
      }}
    />
  )}
  {/* ê¸°ì¡´ ì¹´í…Œê³ ë¦¬, ì§€ì—­ ë“±ì˜ ì¹©ë“¤ */}
</Box>
```

---

### 3. ì§€ë„ ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€

**HomePage.tsx**
```typescript
// ì„ í˜¸ ì§€ì—­ ë°ì´í„° ë¡œë”© ì‹œ ë¡œê·¸
const fetchPreferredRegions = async () => {
  const data = await getMyPreferredRegions();
  console.log('ì„ í˜¸ ì§€ì—­ ë°ì´í„°:', data);
  console.log('1ìˆœìœ„ ì§€ì—­:', firstRegion);
  console.log('1ìˆœìœ„ ì§€ì—­ ì¢Œí‘œ:', coordinate);
};

// ì§€ë„ì—ì„œ ë³´ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ë¡œê·¸
<Button onClick={() => {
  console.log('ì§€ë„ì—ì„œ ë³´ê¸° í´ë¦­:', region);
  const coordinate = getCoordinatesByDistrict(region.district);
  console.log('ì°¾ì€ ì¢Œí‘œ:', coordinate);
  if (coordinate) {
    console.log('ì§€ë„ ì¤‘ì‹¬ ë³€ê²½:', coordinate.latitude, coordinate.longitude);
    setMapCenter({ latitude: coordinate.latitude, longitude: coordinate.longitude });
  } else {
    console.error('ì¢Œí‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. district:', region.district);
  }
}}>
  ì§€ë„ì—ì„œ ë³´ê¸°
</Button>
```

---

### 4. ê´€ë¦¬ì í˜ì´ì§€ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§

#### ìˆ˜ì •ëœ íŒŒì¼

**1) adminService.ts**
```typescript
// ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ì¸í„°í˜ì´ìŠ¤
export interface SystemMetrics {
  cpuUsage: number;
  memoryUsage: number;
  diskUsage: number;
  totalMemory: number;
  usedMemory: number;
  freeMemory: number;
}

// ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ì¡°íšŒ
export const getSystemMetrics = async (): Promise<SystemMetrics> => {
  const response = await api.get('/user/admin/system/metrics');
  return response.data;
};
```

**2) DashboardPage.tsx**
```typescript
// ì‹¤ì‹œê°„ ì• ë‹ˆë©”ì´ì…˜ ìƒíƒœ
const [animatedCpu, setAnimatedCpu] = useState(0);
const [animatedMemory, setAnimatedMemory] = useState(0);
const [animatedDisk, setAnimatedDisk] = useState(0);

// 5ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
useEffect(() => {
  const interval = setInterval(() => {
    fetchStats();
  }, 5000);
  return () => clearInterval(interval);
}, []);

// ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
useEffect(() => {
  if (!metrics) return;
  
  const animateValue = (start: number, end: number, setter: (v: number) => void) => {
    const duration = 1000;
    const steps = 60;
    const increment = (end - start) / steps;
    let current = start;
    let step = 0;
    
    const timer = setInterval(() => {
      step++;
      current += increment;
      if (step >= steps) {
        setter(end);
        clearInterval(timer);
      } else {
        setter(current);
      }
    }, duration / steps);
  };
  
  animateValue(animatedCpu, metrics.cpuUsage, setAnimatedCpu);
  animateValue(animatedMemory, metrics.memoryUsage, setAnimatedMemory);
  animateValue(animatedDisk, metrics.diskUsage, setAnimatedDisk);
}, [metrics]);

// ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ë¥  ì¹´ë“œì— í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
<Box sx={{
  animation: 'pulse 2s ease-in-out infinite',
  '@keyframes pulse': {
    '0%, 100%': { opacity: 1 },
    '50%': { opacity: 0.8 },
  },
}}>
  <LinearProgress 
    variant="determinate" 
    value={animatedCpu}
    sx={{
      transition: 'all 0.3s ease-in-out',
    }}
  />
</Box>
```

---

### 5. ê²Œì‹œê¸€/ëŒ“ê¸€ ì‘ì„± í›„ ì‘ë‹µ ì²˜ë¦¬ ìˆ˜ì •

#### ë¬¸ì œì 
- ë°±ì—”ë“œê°€ `{post: {...}}` í˜•íƒœë¡œ ì‘ë‹µì„ ë°˜í™˜
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `response.data`ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ `post.id`ê°€ `undefined`ê°€ ë¨
- ê²°ê³¼ì ìœ¼ë¡œ `/api/community/posts/NaN`ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë˜ì–´ 500 ì—ëŸ¬ ë°œìƒ

#### í•´ê²° ë°©ë²•

**communityService.ts**
```typescript
// ê²Œì‹œê¸€ ì‘ì„±
export const createPost = async (data: CreatePostRequest): Promise<Post> => {
  const response = await api.post('/api/community/posts', data);
  // Backendì—ì„œ {post: {...}} í˜•íƒœë¡œ ë°˜í™˜í•˜ë¯€ë¡œ post ì¶”ì¶œ
  return response.data.post || response.data;
};

// ê²Œì‹œê¸€ ìˆ˜ì •
export const updatePost = async (postId: number, data: Partial<CreatePostRequest>): Promise<Post> => {
  const response = await api.put(`/api/community/posts/${postId}`, data);
  // Backendì—ì„œ {post: {...}} í˜•íƒœë¡œ ë°˜í™˜í•˜ë¯€ë¡œ post ì¶”ì¶œ
  return response.data.post || response.data;
};
```

---

### 6. ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ ê°œì„ 

#### ìˆ˜ì •ëœ íŒŒì¼

**1) Layout.tsx**
```typescript
// í—¤ë”ì—ì„œ ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ
<Typography variant="body2" sx={{ mr: 1 }}>
  {user?.name || user?.username}ë‹˜
</Typography>
```

**2) ProfilePage.tsx**
```typescript
// í”„ë¡œí•„ í˜ì´ì§€ì—ì„œ ì´ë¦„ í‘œì‹œ
<Typography variant="h6" gutterBottom>
  {profile?.name || profile?.username}
</Typography>
```

**3) CommunityPage.tsx**
```typescript
// ê²Œì‹œê¸€ ì‘ì„±ì í‘œì‹œ
<Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
  <Avatar sx={{ width: 24, height: 24 }}>
    {post.userName ? post.userName.charAt(0) : 'U'}
  </Avatar>
  <Typography variant="caption" color="text.secondary">
    {post.userName || `ì‚¬ìš©ì${post.userId}`}
  </Typography>
</Box>
```

**4) CommunityDetailPage.tsx**
```typescript
// ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì‘ì„±ì í‘œì‹œ
<Avatar sx={{ width: 32, height: 32 }}>
  {post.userName ? post.userName[0] : 'U'}
</Avatar>
<Typography variant="body2" color="text.secondary">
  {post.userName || `ì‚¬ìš©ì${post.userId}`}
</Typography>

// ëŒ“ê¸€ ì‘ì„±ì í‘œì‹œ
<Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>
  <Avatar sx={{ width: 24, height: 24 }}>
    {comment.userName ? comment.userName.charAt(0) : 'U'}
  </Avatar>
  <Typography variant="body2" fontWeight="bold">
    {comment.userName || `ì‚¬ìš©ì${comment.userId}`}
  </Typography>
</Box>
```

**5) communityService.ts - Comment ì¸í„°í˜ì´ìŠ¤**
```typescript
export interface Comment {
  id: number;
  postId: number;
  userId: number;
  userName?: string;  // ì¶”ê°€
  parentCommentId?: number;
  content: string;
  likeCount: number;
  dislikeCount: number;
  isDeleted: boolean;
  createdAt: string;
  updatedAt: string;
  replies?: Comment[];
}
```

---

## ğŸ“Š ë°°í¬ í˜„í™©

### ë°±ì—”ë“œ ì»¤ë°‹ (ìµœì‹ ìˆœ)
1. `fix: correct InternalUserController path to work with context-path`
   - InternalUserControllerì˜ ê²½ë¡œë¥¼ `/user/internal`ë¡œ ìˆ˜ì •
   - context-path `/api`ì™€ ê²°í•©í•˜ì—¬ ì‹¤ì œ ê²½ë¡œ `/api/user/internal` ìƒì„±
   
2. `fix: fetch user names from User Service for posts`
   - PostServiceì—ì„œ User Service APIë¥¼ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©ì ì´ë¦„ ì¡°íšŒ
   
3. `feat: integrate User Service for fetching user names in Community Service`
   - UserServiceClient ì¶”ê°€
   - RestTemplateConfig ì¶”ê°€
   - InternalUserController ì¶”ê°€ (User Service)
   - CommentServiceì—ì„œ User Service ì—°ë™
   
4. `feat: add real system metrics API for admin dashboard monitoring`
   - SystemMetrics DTO ì¶”ê°€
   - SystemMetricsService ì¶”ê°€
   - AdminUserControllerì— `/system/metrics` ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
   
5. `fix: accept userId in CreateCommentRequest for comment creation`
6. `fix: accept userId in request for all community features (post, vote, comment, recruitment)`
7. `feat: add popular post feature with daily pinning and fire icon`

### í”„ë¡ íŠ¸ì—”ë“œ ì»¤ë°‹ (ìµœì‹ ìˆœ)
1. `fix: extract post from response in createPost and updatePost`
   - ë°±ì—”ë“œ ì‘ë‹µ `{post: {...}}` í˜•íƒœì—ì„œ post ê°ì²´ ì¶”ì¶œ
   - createPost, updatePostì—ì„œ `response.data.post || response.data` ì‚¬ìš©
   
2. `fix: display user names correctly in community and profile pages`
   - Layout.tsx: `user?.name || user?.username` í‘œì‹œ
   - ProfilePage.tsx: `profile?.name || profile?.username` í‘œì‹œ
   - CommunityPage.tsx: `post.userName` í‘œì‹œ
   - CommunityDetailPage.tsx: `post.userName`, `comment.userName` í‘œì‹œ
   - Comment ì¸í„°í˜ì´ìŠ¤ì— `userName` í•„ë“œ ì¶”ê°€
   
3. `feat: add real-time system monitoring to admin dashboard`
   - ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ì¡°íšŒ API ì—°ë™
   - 5ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
   - ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€ (ê°’ ë³€ê²½ ì‹œ ë¶€ë“œëŸ¬ìš´ ì „í™˜)
   - í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
   
4. `fix: include userId in comment creation request`
5. `fix: pass userId to all community API calls (post, vote, comment, recruitment) and add debug logs for map`
6. `feat: add popular post indicator with fire icon and animation`

---

## ğŸ”„ í–¥í›„ ì‘ì—… ì˜ˆì •

### ì¸ì¦ ì‹œìŠ¤í…œ ì™„ì„±
- Gateway Serviceì—ì„œ JWT í† í° ê²€ì¦ í›„ userIdë¥¼ í—¤ë”ì— ì¶”ê°€
- Community Serviceì—ì„œ `@RequestAttribute`ë¡œ userId ìë™ ì£¼ì…
- ì„ì‹œë¡œ ì¶”ê°€í•œ ìš”ì²­ ë³¸ë¬¸/ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì˜ userId ì œê±°

### ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
- Community Serviceì˜ `posts` í…Œì´ë¸”ì— `is_pinned`, `pinned_until` ì»¬ëŸ¼ ì¶”ê°€
- ê¸°ì¡´ ë°ì´í„°ì˜ ê¸°ë³¸ê°’ ì„¤ì • (is_pinned = false, pinned_until = null)

---

## âœ… í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥
- [x] ê²Œì‹œê¸€ ì‘ì„± (userId ì „ë‹¬)
- [x] ê²Œì‹œê¸€ íˆ¬í‘œ (ì¢‹ì•„ìš”/ì‹«ì–´ìš”)
- [x] ëŒ“ê¸€ ì‘ì„±
- [x] ëŒ“ê¸€ íˆ¬í‘œ
- [x] ëª¨ì§‘ ì°¸ì—¬/ì·¨ì†Œ
- [x] ê²Œì‹œê¸€ ì‘ì„± í›„ ìƒì„¸ í˜ì´ì§€ ì´ë™
- [x] ì‚¬ìš©ì ì´ë¦„ í‘œì‹œ (ê²Œì‹œê¸€/ëŒ“ê¸€)

### ì¸ê¸° ê²Œì‹œê¸€
- [ ] ë§¤ì¼ ìì • ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ í™•ì¸
- [ ] ì¶”ì²œ 10ê°œ ì´ìƒ ê²Œì‹œê¸€ ì„ ì • í™•ì¸
- [ ] 24ì‹œê°„ í›„ ìë™ ê³ ì • í•´ì œ í™•ì¸
- [x] ëª©ë¡ì—ì„œ ì¸ê¸° ì•„ì´ì½˜ í‘œì‹œ í™•ì¸
- [ ] ì¸ê¸° ê²Œì‹œê¸€ ìµœìƒë‹¨ ì •ë ¬ í™•ì¸

### ê´€ë¦¬ì í˜ì´ì§€
- [x] ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­ ì¡°íšŒ
- [x] 5ì´ˆë§ˆë‹¤ ìë™ ìƒˆë¡œê³ ì¹¨
- [x] ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
- [x] ì‚¬ìš©ì í†µê³„ ì¡°íšŒ
- [x] ì»¤ë®¤ë‹ˆí‹° í†µê³„ ì¡°íšŒ

### ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì—°ë™
- [x] User Service â†’ Community Service (ì‚¬ìš©ì ì´ë¦„ ì¡°íšŒ)
- [x] 404 ì—ëŸ¬ ì²˜ë¦¬ (ì‚¬ìš©ì ì—†ì„ ë•Œ fallback)
- [x] context-path ì˜¬ë°”ë¥¸ ì²˜ë¦¬

---

## ğŸ“ ì°¸ê³ ì‚¬í•­

### ìŠ¤ì¼€ì¤„ëŸ¬ ì‹¤í–‰ ì‹œê°„
- **ì¸ê¸° ê²Œì‹œê¸€ ì„ ì •**: ë§¤ì¼ 00:00:00 (ìì •)
- **ë§Œë£Œëœ ê³ ì • í•´ì œ**: ë§¤ ì‹œê°„ ì •ê°

### ì¸ê¸° ê²Œì‹œê¸€ ì„ ì • ê¸°ì¤€
- ì§€ë‚œ 24ì‹œê°„ ë™ì•ˆ ì‘ì„±ëœ ê²Œì‹œê¸€ ì¤‘
- ì¢‹ì•„ìš”(likeCount)ê°€ ê°€ì¥ ë§ì€ ê²Œì‹œê¸€
- ìµœì†Œ 10ê°œ ì´ìƒì˜ ì¢‹ì•„ìš” í•„ìš”
- ì„ ì •ëœ ê²Œì‹œê¸€ì€ 24ì‹œê°„ ë™ì•ˆ ê³ ì •

### ì„ì‹œ ì¸ì¦ ë°©ì‹
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ IDë¥¼ ìš”ì²­ì— í¬í•¨
- ë°±ì—”ë“œì—ì„œ `@RequestAttribute` ìš°ì„ , ì—†ìœ¼ë©´ ìš”ì²­ ë³¸ë¬¸/ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì‚¬ìš©
- ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” JWT í† í° ê²€ì¦ í›„ Gatewayì—ì„œ userId ì£¼ì… í•„ìš”

